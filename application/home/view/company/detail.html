{extend name="public/common"}

{block name="style"}
<title>党员之家</title>
<link rel="stylesheet" href="/home/css/common/detail.css">
<link rel="stylesheet" href="/home/css/company/detail.css">
<style>
	.scrollDiy{
		position: absolute;
		top:0;
		bottom:0;
		overflow-y: scroll;
		overflow-x: hidden;
		/* 增加该属性，可以增加弹性 */
		-webkit-overflow-scrolling: touch;
		width:100%;
	}
</style>
{/block}

{block name="body"}
<div class="scrollDiy">
	<div class="article special">
		<div class="title limit_">哦哦</div>
		<div class="note">
			<span class="read">1455</span>
			<span class="comment">1455</span>
			<span class="fl">2015.3654</span>
		</div>
	</div>

		<div class="content">
			<div class="uecontent">
				<img src="/home/images/common/banner.png">
				<p class="name">我是名字</p>
				<span class="department">企业党支部</span>
			</div>
			<p>曲面得得得哈哈哈哈东阿忙得很返回到，涣发大号的哈哈哈打哈哈的好的名，单架构我我到你当活动阿尔。</p>
			<div class="like special">
				<span class="isgood good_ like" onclick="isGood(this,15)">2345</span>
				<!--<span class="isgood good like" onclick="isGood(this,15)">9999</span>-->
				<span id="addnum"><em>+1</em></span>
			</div>
		</div>
		<div class="line"></div>
	<div class="comment">
		<div class="sum">论坛讨论</div>
		<div class="lists">
			<div class="list clear">
				<div class="fl">
					<img src="" alt="用户" class="user">
				</div>
				<div class="fl mid">
					<div class="name limit">楼主蓝</div>
					<div class="time">2017-6-28</div>
					<div class="content" >即将赛事所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所所，司机姐姐军军军军军军军军军军军军军军军军军军军，二甲基军军军军军军军军军军军军军军军军军军军军军，二甲基军军军军军军军军军军军军军军军军军军。</div>
				</div>
				<div class="fr isgood good_" onclick="isGood(this,0)">1002</div>
				<!--<div class="fr isgood good" onclick="isGood(this,0)">1002</div>-->
			</div>
		</div>
		<div class="tip"></div>
		<div class="loading hidden">
			<div class="typing_loader"></div>
		</div>
	</div>
	<div class="bottom clear">
		<div class="myword fl">
			<input type="text" placeholder="说说你的感想！">
		</div>
		<div class="send fr" onclick="send(this,15)">发送</div>
	</div>
</div>
{/block}

{block name="script"}
<script src="/home/js/reset.js"></script>
<script>
	var scrollNow = true;//判断下拉请求是否执行中.false为正在请求
	$(function(){
		var len = $(".list" ).length;
		if(len >= 7){
			$('.tip' ).text('上拉加载更多');
			//上拉加载评论
			loadScroll();
		}
		//ios fix兼容
//	tofixed();
	});


	//点赞
	function isGood(e,type,id){
		var n = $(e ).text();
		var addnum = $("#addnum");
		$(e).toggleClass('good' ).toggleClass('good_');
		if($(e ).hasClass('good')){
			n--;
			if($(e ).hasClass('like')) {
				addnum.show().html("<em class='addmove'>-1</em>");
			}
		}else{
			n++;
			if($(e ).hasClass('like')) {
				addnum.show().html("<em class='addmove add'>+1</em>");
			}
		}
		$(e ).text(n);
		//type：1文章，2评论
		$.ajax({
			type:"post",
			url:"{:Url('Base/like')}",
			data:{
				type:type,
				aid:id,
			},
			success:function(data){
				$(e ).removeClass('bigger');
			}
		})
	}


	//评论
	function send(e,type,id){
		var it = $(e ).prev().find('input');
		if(it.val().length < 5){
			alert("您的评论少于5个字");
			return false;
		}
		if(it.val() != ''){
			$.ajax({
				type:"post",
				url:"{:Url('Base/comment')}",
				data:{
					type:type,
					aid:id,
					content:it.val()
				},
				beforeSend:function(){
					swal({
						title: ' ',
						text: '评论提交中...',
						showConfirmButton:false
					});
				},
				success:function(data){
					var data = data.data;
					var userid = "'"+data.create_user+"'";
					var html = '';
					html +=
							'<div class="list clear">'+
							'<div class="fl">'+
							'<img src="'+data.header+'" alt="用户头像" class="user">'+
							'</div>'+
							'<div class="fl mid">'+
							'<div class="name limit">'+data.nickname+'</div>'+
							'<div class="time">'+data.time+'</div>'+
							'<div class="content" >'+it.val()+'</div>'+
							'</div>'+
							'<div class="fr isgood good" onclick="isGood(this,0,'+data.id+')">'+data.likes+'</div>'+
							'</div>'+
							'</div>';
					$('.lists' ).prepend(html);
					it.val('');
					var sum = $('.sum span' );
					sum.text(parseInt(sum.text())+1);
					swal({
						title: ' ',
						text: '评论成功',
						type: 'success',
						confirmButtonText:'确定',
						timer:3000
					});
				}
			});
		}else{
			wAlert('您的评论不能为空');
		}
	}
</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>
<script>
	//---微信接口JS-SDK的调用
	wx.config({
		debug: false,
		appId: '{$jsSign.appid}', // 必填，公众号的唯一标识
		timestamp: {$jsSign['timestamp']}, // 必填，生成签名的时间戳，切记时间戳是整数型，别加引号
		nonceStr: '{$jsSign.noncestr}', // 必填，生成签名的随机串
		signature: '{$jsSign.signature}', // 必填，签名，见附录1
		jsApiList: [
			'checkJsApi',
			'chooseImage',
			'previewImage',
			'uploadImage',
			'downloadImage',
			'onMenuShareTimeline',
			'onMenuShareAppMessage',
		]
	});

	wx.ready(function () {
		//分享到朋友圈
		wx.onMenuShareTimeline({
			title: '{$detail.title}',
			link: '{$detail.link}',
			imgUrl: '{$detail.share_image}',
			success: function () {
				// 用户确认分享后执行的回调函数
			},
			cancel: function () {
				// 用户取消分享后执行的回调函数
			}
		});
		//分享给朋友
		wx.onMenuShareAppMessage({
			title: '{$detail.title}', // 分享标题
			desc: '{$detail.desc}', // 分享描述
			link: '{$detail.link}', // 分享链接
			imgUrl: '{$detail.share_image}', // 分享图标
			type: '', // 分享类型,music、video或link，不填默认为link
			dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
			success: function () {
				// 用户确认分享后执行的回调函数
			},
			cancel: function () {
				// 用户取消分享后执行的回调函数
			}
		});

	});
	wx.error(function (res) {
		alert('wx.error: '+JSON.stringify(res));
	});
</script>
{/block}