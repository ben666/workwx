{extend name="public/common"}

{block name="style"}
<link rel="stylesheet" href="/home/css/common/tip.css">
<title></title>
<style>
    .content ul li img{
        float: left;
        height: 40px;
        width: 40px;
        margin-left: 16px;
    }
    .content p{
        margin-top: 14px;
        margin-left: 10px;
        position: relative;
        left: 10px;
        font-size: 1.3rem;
        color: #333;
        width:70%;
    }
    .content p:nth-child(4){
        margin-top: 8px;
        clear: both;
        position: relative;
        left: 55px;
        width: 65%;
        top: -15px;
    }
    .content span:nth-child(3){
        float: right;
        margin-top: -18px;
        margin-right: 16px;
        color: #999;
        font-size: 10px;
    }
    .content ul li:after{
        display: block;
        content: '';
        height: 1px;
        background:#f1f1f1 ;
        width: 81vw;
        margin-left: 55px;
    }
    .scrollDiy{
        position:absolute;
        top: 0;
        bottom:0;
        overflow: scroll;
        -webkit-overflow-scrolling: touch;
        width: 100%;
    }

</style>
{/block}

{block name="body"}
<div class="scrollDiy">
<div class="content">
    <ul>
        <li>
            <img src="/home/images/index/1.png">
            <p>张三</p>
            <span>2017-07-07</span>
            <p>不错哦，不错哦不错哦不错哦不错哦不错哦不错哦不错哦不错哦不错哦不错错哦不错哦不错哦</p>
        </li>
    </ul>
</div>
<div class="tip"></div>
<div class="loading hidden">
    <div class="typing_loader"></div>
</div>
</div>
</div>
{/block}

{block name="script"}
<script>
    var scrollNow = true;//判断下拉请求是否执行中.false为正在请求
$(function(){
    var len  = $(".content").find("ul li").length;
    if(len >= 9){
        $('.tip').text('上拉加载更多');
        loadScroll();
    }
})

//滚动加载
function loadScroll(){
    var windowHeight = $(".scrollDiy").height();
    $(".scrollDiy").off("scroll").on("scroll",function () {
        var dh = $(".content").height();
//		console.log("dh"+dh);
        var end = windowHeight + $(".scrollDiy" ).scrollTop();
        var len  = $(".content").find("ul li").length;
        var tip = $(".tip");
        var loading = $('.loading');
        if(dh == end){
            scrollNow = false;
            $.ajax({
                type:"post",
                url:"",
                data:{
                    length:len,
                },
                beforeSend: function(XMLHttpRequest){
                    tip.hide();
                    loading.toggleClass('hidden');
                },
                success:function(data){
                    loading.toggleClass('hidden');
                    tip.show();
                    if(data.code == 1){
                        addList(data);
                        var dataLen =data.data.length;
                        if(data.data.length == 9){
                            tip.text('上拉加载更多');
                        }
                    }else{
                        tip.text('没有更多了');
                        $(window ).off("scroll");
                    }
                    scrollNow = true;
                }
            })
        }
    })
}

    //列表添加
    function  addList(data) {
        var html = '';
        var lists = data.data;
            $.each(lists,function (index,item) {
                html += '<li>'+
                        '<img src="/home/images/index/1.png">'+
                        '<p>张三</p>'+
                        '<span>2017-07-07</span>'+
                        '<p>不错哦，不错哦不错哦不错哦不错哦不错哦不错哦不错哦不错哦不错哦不错错哦不错哦不错哦</p>'+
                        '</li>';
            });
            $(".content ul").append(html);
    }
</script>
{/block}